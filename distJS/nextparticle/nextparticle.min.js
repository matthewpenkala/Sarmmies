function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function h(t,i){for(var e,h=0;h<i.length;h++)(e=i[h]).enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}return function(t,i,e){return i&&h(t.prototype,i),e&&h(t,e),t}}();!function(t){function e(t){_classCallCheck(this,e);var i={};t&&(t.nodeName?(i=JSON.parse(JSON.stringify(t.dataset)),"IMG"===t.nodeName?i.image=t:i.wrapperElement=t):i=t),this.state="stopped",this.touches=[],this.on("imageLoaded",this._onImageLoaded),this._initImage(i)}var h,i,a,n,r,o,c,s,d,m,l,g,u,v,f,x,p,y,M,w,_,I,P,b,k,E,H=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){setTimeout(t,10)},F=(_createClass(e,[{key:"on",value:function(t,i){this.events=this.events||{},this.events[t]=this.events[t]||[],this.events[t].push(i)}},{key:"emit",value:function(t,i){var e=this.events[t];if(e&&e.length){var h=!0,s=!1;try{for(var a,n=e[Symbol.iterator]();!(h=(a=n.next()).done);h=!0)a.value.call(this,i)}catch(t){s=!0;var r=t}finally{try{!h&&n.return&&n.return()}finally{if(s)throw r}}}}},{key:"start",value:function(t){t=t||{},this.initPosition=t.initPosition||this.initPosition,this.initDirection=t.initDirection||this.initDirection,this.canvas&&(this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.display=""),this._initOrigins(),this._initParticles(),"running"!==this.state&&(this.state="running",this.disableInteraction||("ontouchstart"in window||window.navigator.msPointerEnabled?(document.body.addEventListener("touchstart",this._touchHandler),document.body.addEventListener("touchmove",this._touchHandler),document.body.addEventListener("touchend",this._clearTouches),document.body.addEventListener("touchcancel",this._clearTouches)):(this.canvas.addEventListener("mousemove",this._mouseHandler),this.canvas.addEventListener("mouseout",this._clearTouches))),this._animate())}},{key:"stop",value:function(t){t=t||{},this.fadePosition=t.fadePosition||this.fadePosition,this.fadeDirection=t.fadeDirection||this.fadeDirection,this._fade(),document.body.removeEventListener("touchstart",this._touchHandler),document.body.removeEventListener("touchmove",this._touchHandler),document.body.removeEventListener("touchend",this._clearTouches),document.body.removeEventListener("touchcancel",this._clearTouches),this.canvas.removeEventListener("mousemove",this._mouseHandler),this.canvas.removeEventListener("mouseout",this._clearTouches)}},{key:"_animate",value:function(){var t=this;"stopped"===this.state?this.emit("stopped"):(this._calculate(),this._draw(),H(function(){return t._animate()}))}},{key:"_onImageLoaded",value:function(t){this.imageWidth=this.image.naturalWidth||this.image.width,this.imageHeight=this.image.naturalHeight||this.image.height,this.imageRatio=this.imageWidth/this.imageHeight,this.width=this.width||this.imageWidth,this.height=this.height||this.imageHeight,this.renderSize=(this.width+this.height)/4,this.srcImage&&(this.srcImage.style.display="none"),this._initSettings(t),this._initContext(t),this._initResponsive(t),this.start()}},{key:"_initImage",value:function(t){var i=this;this.srcImage=t.image,!this.srcImage&&t.imageId&&(this.srcImage=document.getElementById(t.imageId)),this.imageUrl=t.imageUrl||this.srcImage.src,this.image=document.createElement("img"),this.wrapperElement=t.wrapperElement||this.srcImage.parentElement,this.image.onload=function(){return i.emit("imageLoaded",t)},this.image.crossOrigin="Anonymous",t.addTimestamp&&(/\?/.test(this.imageUrl)?this.imageUrl+="&d="+Date.now():this.imageUrl+="?d="+Date.now()),this.image.src=this.imageUrl}},{key:"_initContext",value:function(t){(this.canvas=t.canvas)||this.context||!this.wrapperElement||(this.canvas=document.createElement("canvas"),this.wrapperElement.appendChild(this.canvas)),this.convas&&(this.convas.style.display="none"),this.context=t.context,this.renderer=t.renderer||"default"}},{key:"_defaultInitContext",value:function(){this.context=this.context||this.canvas.getContext("2d")}},{key:"_webglInitContext",value:function(){this.context=this.context||this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl"),this.fragmentShaderScript="\n        void main(void) {\n         gl_FragColor = vec4(1, 1, 1, 0.7);\n        }\n      ",this.vertexShaderScript="\n        attribute vec3 vertexPosition;\n        vec3 offset = vec3(-5, 3, 100);\n        vec3 mirror = vec3(0.01, -0.01, 1);\n\n        uniform mat4 modelViewMatrix;\n        uniform mat4 perspectiveMatrix;\n\n        void main(void) {\n          gl_Position = perspectiveMatrix * modelViewMatrix * vec4(mirror * vertexPosition + offset, 1.0);\n          gl_PointSize = 1.0;\n        }\n      ",this.context.viewport(0,0,this.width,this.height);var t=this.context.createShader(this.context.VERTEX_SHADER);this.context.shaderSource(t,this.vertexShaderScript),this.context.compileShader(t);var i=this.context.createShader(this.context.FRAGMENT_SHADER);this.context.shaderSource(i,this.fragmentShaderScript),this.context.compileShader(i),this.program=this.context.createProgram(),this.context.attachShader(this.program,t),this.context.attachShader(this.program,i),this.context.linkProgram(this.program),this.context.useProgram(this.program),this.vertexPosition=this.context.getAttribLocation(this.program,"vertexPosition"),this.context.enableVertexAttribArray(this.vertexPosition),this.context.clearColor(0,0,0,1),this.context.clearDepth(1),this.context.enable(this.context.BLEND),this.context.disable(this.context.DEPTH_TEST),this.context.blendFunc(this.context.SRC_ALPHA,this.context.ONE),this.vertexBuffer=this.context.createBuffer(),this.context.bindBuffer(this.context.ARRAY_BUFFER,this.vertexBuffer),this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT);var e=this.width/this.height,e=[2/((i=(h=+Math.tan(+Math.PI/360))*e)-(e=-i)),0,(i+e)/(i-e),0,0,2/(h-(t=-h)),(h+t)/(h-t),0,0,0,10001/9999,2.000200020002,0,0,-1,0],h=this.context.getAttribLocation(this.program,"vertexPosition");this.context.vertexAttribPointer(h,3,this.context.FLOAT,!1,0,0),t=this.context.getUniformLocation(this.program,"modelViewMatrix"),h=this.context.getUniformLocation(this.program,"perspectiveMatrix"),this.context.uniformMatrix4fv(t,!1,new Float32Array(e)),this.context.uniformMatrix4fv(h,!1,new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]))}},{key:"_initSettings",value:function(t){this.width=t.width||this.width,this.height=t.height||this.height,this.maxWidth=t.maxWidth,this.maxHeight=t.maxHeight,this.minWidth=t.minWidth,this.minHeight=t.minHeight,this.maxWidth&&(/%$/.test(this.maxWidth)?this.maxWidth=this.width*this.maxWidth.replace("%","")/100:this.maxWidth*=1),this.maxHeight&&(/%$/.test(this.maxHeight)?this.maxHeight=this.height*this.maxHeight.replace("%","")/100:this.maxHeight*=1),this.minWidth&&(/%$/.test(this.minWidth)?this.minWidth=this.width*this.minWidth.replace("%","")/100:this.minWidth*=1),this.minHeight&&(/%$/.test(this.minHeight)?this.minHeight=this.height*this.minHeight.replace("%","")/100:this.minHeight*=1),this.alphaFade=.4,this.gravity=+t.gravity||.08,this.particleGap=+t.particleGap||3,this.layerCount=t.layerCount||1,this.layerDistance=t.layerDistance||this.particleGap,this.initPosition=t.initPosition||"random",this.initDirection=t.initDirection||"random",this.fadePosition=t.fadePosition||"none",this.fadeDirection=t.fadeDirection||"none",this.noise=Number.isNaN(+t.noise)?10:+t.noise,this.disableInteraction=t.disableInteraction,this.mouseForce=+t.mouseForce||30,this.color=t.color,this.colorArr=t.colorArr||this.colorArr}},{key:"_initResponsive",value:function(t){var i=this;(this.responsiveWidth=this.wrapperElement&&t.responsiveWidth)&&(this.on("stopped",function(){i.width=i.wrapperElement.clientWidth,nextParticle.start()}),this.wrapperElement.addEventListener("resize",function(){return i.stop()}),this.width=this.wrapperElement.clientWidth)}},{key:"_calculate",value:function(){for(this.vertices=[],f=v=0;f<this.particles.length;f++){p=this.origins[f],y=this.particles[f],a=p.x-y.x+(Math.random()-.5)*this.noise,n=p.y-y.y+(Math.random()-.5)*this.noise,r=p.z-y.z+(Math.random()-.5)*this.noise/1e3,o=Math.sqrt(a*a+n*n+r*r),c=.01*o,y.vx+=a/o*c*this.speed,y.vy+=n/o*c*this.speed,y.vz+=r/o*c*this.speed;var t=!0,i=!1,e=void 0;try{for(var h,s=this.touches[Symbol.iterator]();!(t=(h=s.next()).done);t=!0)M=h.value,a=y.x-M.x,n=y.y-M.y,r=y.z-M.z,o=Math.sqrt(a*a+n*n+r*r),c=this.mouseForce*M.force/o,y.vx+=a/o*c*this.speed,y.vy+=n/o*c*this.speed,y.vz+=r/o*c*this.speed}catch(t){i=!0,e=t}finally{try{!t&&s.return&&s.return()}finally{if(i)throw e}}y.vx*=this.gravityFactor,y.vy*=this.gravityFactor,y.vz*=this.gravityFactor,y.x+=y.vx,y.y+=y.vy,y.z+=y.vz,y.x<0||y.x>=this.width||y.y<0||y.y>=this.height?(y.isHidden=!0,"stopping"===this.state&&(y.isDead=!0)):("stopping"!==this.state||y.isDead||v++,y.isHidden=!1),this.vertices.push(y.x,y.y,y.z)}"stopping"===this.state&&0===v&&(this.state="stopped")}},{key:"_defaultRenderer",value:function(){for(this.depth=Math.max(this.layerDistance*this.layerCount/2,this.mouseForce),this.minZ=-this.depth,this.maxZ=this.depth,u=this.context.createImageData(this.width,this.height),f=0;f<this.origins.length;f++)p=this.origins[f],(y=this.particles[f]).isDead||y.isHidden||(_=~~y.x,I=~~y.y,E=p.color[3],0<this.alphaFade&&1<this.layerCount&&(i=Math.max(Math.min(y.z,this.maxZ),this.minZ)-this.minZ,E=E*(1-this.alphaFade)+i/(this.maxZ-this.minZ)*this.alphaFade*E,E=Math.max(Math.min(~~E,255),0)),i=4*(_+I*this.width),u.data[0+i]=p.color[0],u.data[1+i]=p.color[1],u.data[2+i]=p.color[2],u.data[3+i]=E);this.context.putImageData(u,0,0)}},{key:"_webglRenderer",value:function(){s=new Float32Array(this.vertices),this.context.lineWidth(2.6),this.context.bufferData(this.context.ARRAY_BUFFER,s,this.context.DYNAMIC_DRAW),this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT),this.context.drawArrays(this.context.POINTS,0,this.particles.length),this.context.flush()}},{key:"_initParticles",value:function(){var t=!0,i=!(this.particles=[]);try{for(var e,h=this.origins[Symbol.iterator]();!(t=(e=h.next()).done);t=!0)p=e.value,y={},this._initParticlePosition(p,y),this._initParticleDirection(y),this.particles.push(y)}catch(t){i=!0;var s=t}finally{try{!t&&h.return&&h.return()}finally{if(i)throw s}}}},{key:"_initParticlePosition",value:function(t,i){switch(i.z=0,this.initPosition){case"random":i.x=Math.random()*this.width,i.y=Math.random()*this.height;break;case"top":i.x=3*Math.random()*this.width-this.width,i.y=-Math.random()*this.height;break;case"left":i.x=-Math.random()*this.width,i.y=3*Math.random()*this.height-this.height;break;case"bottom":i.x=3*Math.random()*this.width-this.width,i.y=this.height+Math.random()*this.height;break;case"right":i.x=this.width+Math.random()*this.width,i.y=3*Math.random()*this.height-this.height;break;case"misplaced":i.x=t.x+.3*Math.random()*this.width-.1*this.width,i.y=t.y+.3*Math.random()*this.height-.1*this.height;break;default:i.x=t.x,i.y=t.y}}},{key:"_fade",value:function(){for(this.state="explode"===this.fadePosition||"top"===this.fadePosition||"left"===this.fadePosition||"bottom"===this.fadePosition||"right"===this.fadePosition?"stopping":"stopped",f=0;f<this.origins.length;f++)this._fadeOriginPosition(this.origins[f]),this._fadeOriginDirection(this.particles[f])}},{key:"_fadeOriginPosition",value:function(t){switch(this.fadePosition){case"random":t.x=2*Math.random()*this.width-this.width,t.y=2*Math.random()*this.height-this.height,0<t.x&&(t.x+=this.width),0<t.y&&(t.y+=this.height);break;case"top":t.x=3*Math.random()*this.width-this.width,t.y=-Math.random()*this.height;break;case"left":t.x=-Math.random()*this.width,t.y=3*Math.random()*this.height-this.height;break;case"bottom":t.x=3*Math.random()*this.width-this.width,t.y=this.height+Math.random()*this.height;break;case"right":t.x=this.width+Math.random()*this.width,t.y=3*Math.random()*this.height-this.height}}},{key:"_initParticleDirection",value:function(t){switch(t.vz=0,this.initDirection){case"random":P=2*Math.random()*Math.PI,b=Math.random(),t.vx=.1*this.width*b*Math.sin(P),t.vy=.1*this.height*b*Math.cos(P);break;case"top":P=Math.random()*Math.PI-Math.PI/2,b=Math.random(),t.vx=.1*this.width*b*Math.sin(P),t.vy=.1*this.height*b*Math.cos(P);break;case"left":P=Math.random()*Math.PI+Math.PI,b=Math.random(),t.vx=.1*this.width*b*Math.sin(P),t.vy=.1*this.height*b*Math.cos(P);break;case"bottom":P=Math.random()*Math.PI+Math.PI/2,b=Math.random(),t.vx=.1*this.width*b*Math.sin(P),t.vy=.1*this.height*b*Math.cos(P);break;case"right":P=Math.random()*Math.PI,b=Math.random(),t.vx=.1*this.width*b*Math.sin(P),t.vy=.1*this.height*b*Math.cos(P);break;default:t.vx=0,t.vy=0}}},{key:"_fadeOriginDirection",value:function(t){switch(this.fadeDirection){case"random":P=2*Math.random()*Math.PI,b=Math.random(),t.vx+=.1*this.width*b*Math.sin(P),t.vy+=.1*this.height*b*Math.cos(P);break;case"top":P=Math.random()*Math.PI-Math.PI/2,b=Math.random(),t.vx+=.1*this.width*b*Math.sin(P),t.vy+=.1*this.height*b*Math.cos(P);break;case"left":P=Math.random()*Math.PI+Math.PI,b=Math.random(),t.vx+=.1*this.width*b*Math.sin(P),t.vy+=.1*this.height*b*Math.cos(P);break;case"bottom":P=Math.random()*Math.PI+Math.PI/2,b=Math.random(),t.vx+=.1*this.width*b*Math.sin(P),t.vy+=.1*this.height*b*Math.cos(P);break;case"right":P=Math.random()*Math.PI,b=Math.random(),t.vx+=.1*this.width*b*Math.sin(P),t.vy+=.1*this.height*b*Math.cos(P);break;default:t.vx=0,t.vy=0}}},{key:"_initOrigins",value:function(){for(k=document.createElement("canvas"),this.responsiveWidth&&(this.width=this.wrapperElement.clientWidth),this.ratio=Math.min(this.width,this.maxWidth||Number.POSITIVE_INFINITY)/Math.min(this.height,this.maxHeight||Number.POSITIVE_INFINITY),this.ratio<this.imageRatio?(this.renderWidth=~~Math.min(this.width,this.minWidth||this.imageWidth,this.maxWidth||Number.POSITIVE_INFINITY),this.renderHeight=~~(this.renderWidth/this.imageRatio)):(this.renderHeight=~~Math.min(this.height,this.minHeight||this.imageHeight,this.maxHeight||Number.POSITIVE_INFINITY),this.renderWidth=~~(this.renderHeight*this.imageRatio)),this.offsetX=~~((this.width-this.renderWidth)/2),this.offsetY=~~((this.height-this.renderHeight)/2),k.width=this.renderWidth,k.height=this.renderHeight,(k=k.getContext("2d")).drawImage(this.image,0,0,this.renderWidth,this.renderHeight),d=k.getImageData(0,0,this.renderWidth,this.renderHeight).data,this.origins=[],_=0;_<this.renderWidth;_+=this.particleGap)for(I=0;I<this.renderHeight;I+=this.particleGap)if(f=4*(_+I*this.renderWidth),0<(E=d[f+3]))if(this.colorArr)for(x=0;x<this.layerCount;x++)this.origins.push({x:this.offsetX+_,y:this.offsetY+I,z:x*this.layerDistance-this.layerCount*this.layerDistance/2,color:this.colorArr});else for(m=d[f],l=d[f+1],g=d[f+2],x=0;x<this.layerCount;x++)this.origins.push({x:this.offsetX+_,y:this.offsetY+I,z:x*this.layerDistance-this.layerCount*this.layerDistance/2,color:[m,l,g,E]});this.speed=Math.log(this.origins.length)/10,this.gravityFactor=1-this.gravity*this.speed}},{key:"_parseColor",value:function(t){var i;if("string"==typeof t){if(t=t.replace(" ",""),i=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(t))i=[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)];else if(i=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(t))i=[17*parseInt(i[1],16),17*parseInt(i[2],16),17*parseInt(i[3],16)];else if(i=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(t))i=[+i[1],+i[2],+i[3],+i[4]];else{if(!(i=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(t)))return;i=[+i[1],+i[2],+i[3]]}return i}}},{key:"renderer",get:function(){return this._renderer},set:function(i){this._renderer=i,this._draw=this["_"+i+"Renderer"];try{this["_"+i+"InitContext"]()}catch(t){console.log(t),"default"!==i&&(this.renderer="default")}}},{key:"color",set:function(t){(this.colorArr=this._parseColor(t))&&(isNaN(this.colorArr[3])&&(this.colorArr[3]=255),0<this.colorArr[3]&&this.colorArr[3]<=1&&(this.colorArr[3]*=255))}},{key:"_mouseHandler",get:function(){var i=this;return function(t){i.touches=[{x:t.offsetX,y:t.offsetY,z:0,force:1}]}}},{key:"_touchHandler",get:function(){var i=this;return function(t){for(i.touches=[],h=i.canvas.getBoundingClientRect(),w=0;w<t.changedTouches.length;w++)(M=t.changedTouches[w]).target===i.canvas&&(i.touches.push({x:M.pageX-h.left,y:M.pageY-h.top,z:0,force:M.force||1}),t.preventDefault())}}},{key:"_clearTouches",get:function(){var t=this;return function(){t.touches=[]}}}]),e);t.NextParticle=F;for(var A=document.getElementsByClassName("next-particle"),D=0;D<A.length;D++)(t=A[D]).nextParticle=new F(t)}(window);